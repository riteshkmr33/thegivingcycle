jQuery(function(e){function t(){var t=e("#product-type").val(),a=e("#_virtual").is(":checkbox")?e("input#_virtual:checked").size():e("#_virtual").val(),i=e("#_downloadable").is(":checkbox")?e("input#_downloadable:checked").size():e("#_downloadable").val(),n=".hide_if_downloadable, .hide_if_virtual",r=".show_if_downloadable, .show_if_virtual, .show_if_external";e.each(wcv_frontend_product.product_types,function(e,t){n=n+", .hide_if_"+t,r=r+", .show_if_"+t}),e(n).show().removeClass("is_hidden"),e(n).find("input").removeClass("is_hidden"),e(r).hide().addClass("is_hidden"),e(r).find("input").addClass("is_hidden"),i&&(e(".show_if_downloadable").show().removeClass("is_hidden"),e(".show_if_downloadable").find("input").removeClass("is_hidden")),a&&(e(".show_if_virtual").show().removeClass("is_hidden"),e(".show_if_virtual").find("input").removeClass("is_hidden")),e(".show_if_"+t).show().removeClass("is_hidden"),e(".show_if_"+t).find("input").removeClass("is_hidden"),i&&(e(".hide_if_downloadable").hide().addClass("is_hidden"),e(".hide_if_downloadable").find("input").addClass("is_hidden")),a&&(e(".hide_if_virtual").hide().addClass("is_hidden"),e(".hide_if_virtual").find("input").addClass("is_hidden")),"grouped"==t&&Ink.requireModules(["Ink.Dom.Selector_1","Ink.UI.Tabs_1"],function(e,t){new t("#wcv-tabs").changeTab("#linked_product")}),e(".hide_if_"+t).hide().addClass("is_hidden"),e(".hide_if_"+t).find("input").addClass("is_hidden"),e("input#_manage_stock").change(),e(".wcv-form").parsley().reset()}function a(){var t,a,i=e(".wcv-featuredimg").data("title"),n=e(".wcv-featuredimg").data("button_text");void 0===t?((t=wp.media({title:i,button:{text:n},multiple:!1})).on("select",function(){a=t.state().get("selection").first().toJSON(),0>e.trim(a.url.length)||(attachment_image_url=a.sizes.thumbnail?a.sizes.thumbnail.url:a.url,e(".wcv-featuredimg").append('<img src="'+attachment_image_url+'" alt="'+a.caption+'" title="'+a.title+'" style="max-width: 100%;" />'),e("#_featured_image_id").val(a.id),e(".wcv_featured_image_msg").html(""),e(".wcv-featuredimg").css("background-color","#e1e1e1"),e(".wcv-media-uploader-featured-add").addClass("hidden"),e(".wcv-media-uploader-featured-delete").removeClass("hidden"))}),t.open()):t.open()}function i(){var t,a=e("#product_image_gallery"),i=e("#product_images_container ul.product_images"),r=a.val(),o=e(".wcv-media-uploader-gallery a");if(void 0===t)if((t=wp.media.frames.product_gallery=wp.media({title:o.data("choose"),button:{text:o.data("update")},states:[new wp.media.controller.Library({title:o.data("choose"),filterable:"all",multiple:!0})]})).on("select",function(){t.state().get("selection").map(function(t){(t=t.toJSON()).id&&(r=r?r+","+t.id:t.id,attachment_image=t.sizes.thumbnail?t.sizes.thumbnail.url:t.url,i.append('<li class="wcv-gallery-image" data-attachment_id="'+t.id+'"><img src="'+attachment_image+'" /><ul class="actions"><li><a href="#" class="delete" title="'+o.data("delete")+'"><i class="fa fa-times"></i></a></li></ul></li>'),e(".wcv_gallery_msg").html(""))}),a.val(r)}),n()){var c=e("#product_images_container").data("gallery_max_notice");alert(c)}else t.open();else t.open()}function n(){return e(".wcv-gallery-image").length>e("#product_images_container").data("gallery_max_upload")-1}function r(t,a){e(t).is(":checked")?(a.prop("disabled",!0),a.each(function(){e(this).is(":checkbox")?e(this).removeAttr("checked"):e(this).val("")})):a.prop("disabled",!1)}function o(t){var a=wcv_frontend_product.category_limit;e(".wcv_category_check:checked").length>a?(e(t).prop("checked",""),e(".wcv_check_list_msg").html(wcv_frontend_product.category_limit_msg),e(".wcv_terms_checklist_container").css("background-color","rgba(150,8,12,.55)")):(e(".wcv_check_list_msg").html(""),e(".wcv_terms_checklist_container").css("background-color",""))}var c=!1;e("select#product-type").change(function(){var a=e(this).val();"variable"===a?(e("input#_manage_stock").change(),e("input#_downloadable").prop("checked",!1),e("input#_virtual").removeAttr("checked")):"grouped"===a?(e("input#_downloadable").prop("checked",!1),e("input#_virtual").removeAttr("checked")):"external"===a&&(e("input#_downloadable").prop("checked",!1),e("input#_virtual").removeAttr("checked")),t(),e("ul.wc-tabs li:visible").eq(0).find("a").click(),e("body").trigger("woocommerce-product-type-change",a,e(this))}).change(),e("input#_downloadable, input#_virtual").change(function(){t()}),e(".sale_price_dates_fields").each(function(){var t=!1;e(".sale_price_dates_fields").find("input").each(function(){""!=e(this).val()&&(t=!0)}),t?(e(".sale_schedule").hide(),e(".sale_price_dates_fields").show()):(e(".sale_schedule").show(),e(".sale_price_dates_fields").hide())}),e(".sale_schedule").on("click",function(){return e(".sale_price_dates_fields").show(),e(this).hide(),e(".cancel_sale_schedule").show(),!1}),e(".cancel_sale_schedule").on("click",function(){return e(".sale_price_dates_fields").hide(),e(this).hide(),e(".sale_schedule").show(),!1}),e("input#_manage_stock").change(function(){e(this).is(":checked")?(e("div.stock_fields").show().removeClass("is_hidden"),e("div.stock_fields").find("input").removeClass("is_hidden"),e(".wcv-form").parsley().reset()):(e("div.stock_fields").hide().addClass("is_hidden"),e("div.stock_fields").find("input").addClass("is_hidden"),e(".wcv-form").parsley().reset())}).change(),e(".wcv-media-uploader-featured-delete").on("click",function(t){t.preventDefault(),e(".wcv-featuredimg").html(""),e("#_featured_image_id").val(""),e(".wcv-media-uploader-featured-delete").addClass("hidden"),e(".wcv-media-uploader-featured-add").removeClass("hidden")}),e(".wcv-media-uploader-featured-add").on("click",function(e){return e.preventDefault(),a(),!1}),e("#product_images_container").on("click","a.delete",function(t){var a=e("#product_image_gallery");t.preventDefault(),e(this).closest("li.wcv-gallery-image").remove();var i="";return e("#product_images_container ul li.wcv-gallery-image").css("cursor","default").each(function(){var e=jQuery(this).attr("data-attachment_id");i=i+e+","}),a.val(i),e("#tiptip_holder").removeAttr("style"),e("#tiptip_arrow").removeAttr("style"),!1}),e(".wcv-media-uploader-gallery").on("click",function(e){return e.preventDefault(),i(),!1}),e("#files_download").on("click",".downloadable_files a.insert",function(){return e(this).closest(".downloadable_files").find("tbody").append(e(this).data("row")),!1}),e("#files_download").on("click",".downloadable_files a.delete",function(){return e(this).closest("tr").remove(),!1});var l,d;e(document).on("click",".upload_file_button",function(t){var a=e(this);if(d=a.closest("tr").find(".file_url"),file_id_field=a.closest("tr").find(".file_id"),file_display_field=a.closest("tr").find(".file_display"),t.preventDefault(),l)l.open();else{var i=[new wp.media.controller.Library({library:wp.media.query(),multiple:!0,title:a.data("choose"),priority:20,filterable:"uploaded"})];(l=wp.media.frames.downloadable_file=wp.media({title:a.data("choose"),library:{type:""},button:{text:a.data("update")},multiple:!0,states:i})).on("select",function(){var e="",t="",a=0;l.state().get("selection").map(function(i){t="file_url"==wcv_frontend_product.wcv_file_display?i.attributes.url:i.attributes.filename,(i=i.toJSON()).url&&(e=i.url),i.id&&(a=i.id)}),d.val(e),file_display_field.val(t),file_id_field.val(a)}),l.on("ready",function(){l.uploader.options.uploader.params={type:"downloadable_product"}}),l.open()}}),e(".downloadable_files tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65}),e("#_shipping_fee_national_disable").change(function(){r(e(this),e(".wcv-disable-national-input"))}),e("#_shipping_fee_national_free").change(function(){r(e(this),e("#_shipping_fee_national"))}),e("#_shipping_fee_international_disable").change(function(){r(e(this),e(".wcv-disable-international-input"))}),e("#_shipping_fee_international_free").change(function(){r(e(this),e("#_shipping_fee_international"))}),e("#shipping").on("click",".wcv_shipping_rates a.insert",function(){var t={placeholderOption:"first",width:"100%"},a=e("#wcv_shipping_rates_table tbody tr").length,i=(i=e(this).data("row").replace('id="_wcv_shipping_overrides_"','id="_wcv_shipping_overrides_'+a+'"')).replace('name="_wcv_shipping_overrides_"','name="_wcv_shipping_overrides_'+a+'"');return e(this).closest(".wcv_shipping_rates").find("tbody").append(i).find("select").select2(t),!1}),e("#shipping").on("click",".wcv_shipping_rates a.delete",function(){return e(this).closest("tr").remove(),!1}),e(".wcv_shipping_rates tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65}),e(".select2").select2(),e(".category-select2").select2({maximumSelectionSize:wcv_frontend_product.category_limit}),e(".wcv_category_check").on("change",function(){wcv_frontend_product.category_limit>0&&o(e(this))}),t(),r(e("#_shipping_fee_national_free"),e("#_shipping_fee_national")),r(e("#_shipping_fee_international_free"),e("#_shipping_fee_international")),r(e("#_shipping_fee_national_disable"),e(".wcv-disable-national-input")),r(e("#_shipping_fee_international_disable"),e(".wcv-disable-international-input")),e(".confirm_delete").on("click",function(t){confirm(e(this).data("confirm_text"))||t.preventDefault()});var s=e(".product_attributes").find(".woocommerce_attribute").get();s.sort(function(t,a){var i=parseInt(e(t).attr("rel"),10),n=parseInt(e(a).attr("rel"),10);return i<n?-1:i>n?1:0}),e(s).each(function(t,a){e(".product_attributes").append(a)}),e(".product_attributes .woocommerce_attribute").each(function(t,a){"none"!==e(a).css("display")&&e(a).is(".taxonomy")&&e("select.attribute_taxonomy").find('option[value="'+e(a).data("taxonomy")+'"]').attr("disabled","disabled")}),e(".wcv_product_attributes").on("click",".wcv-metabox h5",function(t){e(t.target).filter(":input, option, .sort").length||e(this).next(".wcv-metabox-content").stop().slideToggle()}).on("click",".expand_all",function(){return e(this).closest(".wcv_product_attributes").find(".wcv-metabox > .wcv-metabox-content").show(),!1}).on("click",".close_all",function(){return e(this).closest(".wcv_product_attributes").find(".wcv-metabox > .wcv-metabox-content").hide(),!1}),e(".wcv-metabox.closed").each(function(){e(this).find(".wcv-metabox-content").hide()}),e(function(t){function a(t,a,i,n){var r=e("#wcv-variation-attributes").data("variation_attr");jQuery.isEmptyObject(r)&&(r={});var o={};return o.values=t,o.position=i,o.name=a,o.label=n,r[a]=o,e("#wcv-variation-attributes").data("variation_attr",r),c&&console.log(e("#wcv-variation-attributes").data("variation_attr")),!1}function i(t){var a=e("#wcv-variation-attributes").data("variation_attr");return jQuery.isEmptyObject(a)||(delete a[t],e("#wcv-variation-attributes").data("variation_attr",a),c&&console.log(e("#wcv-variation-attributes").data("variation_attr"))),!1}function n(t,n,r){var o={},c=t.parent().data("taxonomy"),l=t.parent().data("index_value");if(e("#attribute_variation_"+l).is(":checked"))if(t.is("input")){d=t.val().split(wcv_frontend_product.wc_deliminator);e.each(d,function(t,a){e.trim(a).length>0&&(o[e.trim(a).toLowerCase()]=e.trim(a))})}else{var d=t.select2("data");e.each(d,function(e,t){o[t.id]=t.text})}jQuery.isEmptyObject(o)?i(c):a(o,c,n,r)}function r(){e(".product_attributes .woocommerce_attribute").each(function(t,a){e(".attribute_position",a).val(parseInt(e(a).index(".product_attributes .woocommerce_attribute"),10));var i=e(this).data("index_value");n(a=e("#attribute_values_"+i),e("#attribute_position_"+i).val(),e(this).data("label"))})}e("button.add_attribute").on("click",function(){var t=e(".product_attributes .woocommerce_attribute").size(),a=e("select.attribute_taxonomy").val();if(a){var i=e(".product_attributes "),n=e("#product-type").val(),o={action:"wcv_json_add_attribute",taxonomy:a,i:t,security:wcv_frontend_product.wcv_add_attribute_nonce};return e.post(wcv_frontend_product.ajax_url,o,function(t){t.error?window.alert(t.error):(i.append(t),e("select.attribute_values.select2").select2("destroy").select2(),"variable"!==n&&i.find(".enable_variation").hide(),e(document.body).trigger("wc-enhanced-select-init"),r(),e(document.body).trigger("woocommerce_added_attribute"))}),a&&(e("select.attribute_taxonomy").find('option[value="'+a+'"]').attr("disabled","disabled"),e("select.attribute_taxonomy").val("")),!1}}),e(".product_attributes").on("click","button.select_all_attributes",function(){var t=e(this).parent().data("index_value");return e("#attribute_values_"+t+" > option").prop("selected","selected"),e("#attribute_values_"+t).trigger("change"),!1}),e(".product_attributes").on("click","button.select_no_attributes",function(){var t=e(this).parent().data("index_value"),a=e(this).parent().data("taxonomy");return e("#attribute_values_"+t+" > option").removeAttr("selected"),e("#attribute_values_"+t).trigger("change"),e("#attribute_variation_"+t).is(":checked")&&i(a),!1}),e(".product_attributes").on("change",".attribute_values",function(){var t=e(this).parent().data("index_value"),a=e("#attribute_position_"+t).val(),i=e(this).closest(".woocommerce_attribute").data("label");n(e(this),a,i)}),e(".product_attributes").on("change",".wcv_variation_checkbox",function(){var t=e(this).parent().parent().parent().data("index_value"),a=e(this).closest(".woocommerce_attribute").data("taxonomy"),r=e(this).closest(".woocommerce_attribute").data("label"),o=e("#attribute_position_"+t).val(),c=e("#attribute_values_"+t);e(this).is(":checked")?n(c,o,r):i(a)}),e(".product_attributes").on("click",".remove_row",function(){if(window.confirm(wcv_frontend_product.remove_attribute)){var t=e(this).parent().parent();t.is(".taxonomy")?(t.find("select, input[type=text]").val(""),t.hide(),e(".attribute_taxonomy").find('option[value="'+t.data("taxonomy")+'"]').removeAttr("disabled")):(t.find("select, input[type=text]").val(""),t.hide(),r()),i(t.data("taxonomy"))}return!1}),e(".product_attributes").sortable({items:".woocommerce_attribute",cursor:"move",axis:"y",handle:"h5",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wcv-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.data("index_value");t.item.removeAttr("style"),r()}}),r(),function(){e(".attribute_values").each(function(){var t=e(this).parent().data("index_value"),a=e("#attribute_position_"+t).val(),i=e(this).closest(".woocommerce_attribute").data("label");n(e(this),a,i)})}()}),e(".product_attributes").on("click","button.add_new_attribute",function(){e(".product_attributes").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var t=e(this).parent().data("index_value"),a=e("#attribute_values_"+t),i=e(this).parent().data("taxonomy"),n=window.prompt(wcv_frontend_product.new_attribute_prompt);if(n){var r={action:"wcv_json_add_new_attribute",taxonomy:i,term:n,security:wcv_frontend_product.wcv_add_attribute_nonce};e.post(wcv_frontend_product.ajax_url,r,function(t){t.error?window.alert(t.error):t.slug&&(a.append(e("<option />").attr("value",t.slug).prop("selected","selected").text(t.name)),a.trigger("change"),e(a).select2("destroy").select2()),e(".product_attributes").unblock()})}else e(".product_attributes").unblock();return!1}),e("#wcv-product-edit").submit(function(t){if(e(".downloadable_files").parent().hasClass("is_hidden")||(i=(a=e(".download_file_table")).length)>0&&e(".download_file").each(function(t){""!==e(this).find("td.file_name").find("input").val()&&e(this).find(".file_url").val(e(this).find(".file_display").val())}),1==wcv_frontend_product.require_featured_image&&""===e("#_featured_image_id").val()&&(e(".wcv_featured_image_msg").html(wcv_frontend_product.require_featured_image_msg),e(".wcv-featuredimg").css("background-color","rgba(150,8,12,.55)"),t.preventDefault()),1==wcv_frontend_product.require_gallery_image&&""===e("#product_image_gallery").val()&&(e(".wcv_gallery_msg").html(wcv_frontend_product.require_gallery_image_msg),t.preventDefault()),1==wcv_frontend_product.require_category&&e(".wcv_category_check").length&&e(".wcv_category_check:checked").length<=0&&(e(".wcv_check_list_msg").html(wcv_frontend_product.require_category_msg),e(".wcv_terms_checklist_container").css({color:"#b94a48","background-color":"#f2dede",border:"1px solid #cc0000"}),t.preventDefault()),1==wcv_frontend_product.require_download_file){var a=e(".download_file_table"),i=a.length,n=!0;e(".downloadable_files").parent();e(".downloadable_files").parent().hasClass("is_hidden")||(i>0?e(".download_file").each(function(t){""!==e(this).find("td.file_name").find("input").val()&&""!==e(this).find("td.file_url").find("input").val()||(n=!1)}):n=!1,n||(e(".downloadable_files").append('<span class="wcv_required_form_msg">'+wcv_frontend_product.require_download_file_msg+"</span>"),e(".download_file_table").css({color:"#b94a48","background-color":"#f2dede",border:"1px solid #cc0000"}),t.preventDefault()))}1==wcv_frontend_product.require_attributes&&(e(".woocommerce_attribute ").length>0?e(".wcv_attribute_data").each(function(a){e(this).find(".attribute_values .select2-choices ").length<1&&(e("#attributes").prepend('<span class="wcv_required_form_msg">'+wcv_frontend_product.require_attributes_msg+"</span><br />"),e("a.tabs-tab.attributes").css("background-color","rgba(150,8,12,.55)"),e("a.tabs-tab.attributes").css("color","rgba(255,255,255,.55)"),t.preventDefault())}):(e("#attributes").prepend('<span class="wcv_required_form_msg">'+wcv_frontend_product.require_attributes_msg+"</span><br />"),e("a.tabs-tab.attributes").css("background-color","rgba(150,8,12,.55)"),e("a.tabs-tab.attributes").css("color","rgba(255,255,255,.55)"),t.preventDefault()))})});